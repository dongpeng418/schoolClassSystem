<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.school.classinfo.mapper.SysOrganizationMapper" >
  <resultMap id="BaseResultMap" type="cn.com.school.classinfo.model.SysOrganization" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result property="tenantId" column="tenant_id" jdbcType="INTEGER" />
    <result property="name" column="name" jdbcType="VARCHAR" />
    <result property="parentId" column="parent_id" jdbcType="INTEGER" />
    <result property="level" column="level" jdbcType="INTEGER" />
    <result property="priority" column="priority" jdbcType="INTEGER" />
    <result property="status" column="status" jdbcType="INTEGER" />
    <result property="remark" column="remark" jdbcType="VARCHAR" />
    <result property="createdTime" column="created_time" jdbcType="TIMESTAMP" />
    <result property="createdBy" column="created_by" jdbcType="VARCHAR" />
    <result property="createdIp" column="created_ip" jdbcType="VARCHAR" />
    <result property="updatedBy" column="updated_by" jdbcType="VARCHAR" />
    <result property="updatedTime" column="updated_time" jdbcType="TIMESTAMP" />
    <result property="updatedIp" column="updated_ip" jdbcType="VARCHAR" />
    <result property="lastLoginTime" column="last_login_time" jdbcType="TIMESTAMP" />
    <result property="lastLoginIp" column="last_login_ip" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    id,tenant_id,name,parent_id,level,priority,status,remark,created_by,created_time,created_ip,updated_by,updated_time,
    updated_ip
  </sql>
  
  <select id="selectBySelective" resultMap="BaseResultMap" parameterType="cn.com.school.classinfo.model.SysOrganization" >
   select 
   <include refid="Base_Column_List" />
   from sys_organization
   where status = 0
   <if test="id != null" >
     and  id = #{id,jdbcType=INTEGER}
   </if>
 </select>
  
<insert id="insert" parameterType="cn.com.school.classinfo.model.SysOrganization" useGeneratedKeys="true" keyProperty="id">
    insert into sys_organization
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="tenantId != null" >
        tenant_id,
      </if>
      <if test="name != null" >
        name,
      </if>
      <if test="parentId != null" >
        parent_id,
      </if>
      <if test="level != null" >
        level,
      </if>
      <if test="priority != null" >
        priority,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="createdTime != null" >
        created_time,
      </if>
      <if test="createdBy != null" >
        created_by,
      </if>
      <if test="createdIp != null" >
        created_ip,
      </if>
      <if test="updatedBy != null" >
        updated_by,
      </if>
      <if test="updatedTime != null" >
        updated_time,
      </if>
      <if test="updatedIp != null" >
        updated_ip,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="tenantId != null" >
        #{tenantId,jdbcType=INTEGER},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="parentId != null" >
        #{parentId,jdbcType=INTEGER},
      </if>
      <if test="level != null" >
        #{level,jdbcType=INTEGER},
      </if>
      <if test="priority != null" >
        #{priority,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="createdTime != null" >
        #{createdTime,jdbcType=TIMESTAMP},
      </if>
      <if test="createdBy != null" >
        #{createdBy,jdbcType=VARCHAR},
      </if>
      <if test="createdIp != null" >
        #{createdIp,jdbcType=VARCHAR},
      </if>
      <if test="updatedBy != null" >
        #{updatedBy,jdbcType=VARCHAR},
      </if>
      <if test="updatedTime != null" >
        #{updatedTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedIp != null" >
        #{updatedIp,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
   <update id="updateById" parameterType="cn.com.school.classinfo.model.SysOrganization" >
    update sys_organization
    <set >
      <if test="tenantId != null" >
        tenant_id = #{tenantId,jdbcType=INTEGER},
      </if>
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="level != null" >
        level = #{level,jdbcType=INTEGER},
      </if>
      <if test="priority != null" >
        priority = #{priority,jdbcType=INTEGER},
      </if>
      <if test="parentId != null" >
        parent_id = #{parentId,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="updatedBy != null" >
        updated_by = #{updatedBy,jdbcType=VARCHAR},
      </if>
      <if test="updatedTime != null" >
        updated_time = #{updatedTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updatedIp != null" >
        updated_ip = #{updatedIp,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  <select id="findOrgInfoById" resultMap="BaseResultMap" parameterType="java.lang.Integer"  >
    select 
    <include refid="Base_Column_List" />
    from sys_organization
    <where>
      <if test="id != null" >
        and  id = #{id,jdbcType=INTEGER}
      </if>
    </where>
    and status = 0
  </select>
  
   <select id="findOrgInfoByName" resultMap="BaseResultMap" parameterType="java.lang.String"  >
    select 
    <include refid="Base_Column_List" />
    from sys_organization
    <where>
      <if test="name != null" >
        and  name = #{name,jdbcType=VARCHAR}
      </if>
    </where>
    and status = 0
  </select>

   <select id="selectOrgPriority" resultType="java.lang.Integer" parameterType="java.lang.Integer" >
     select max(priority) from sys_organization where parent_id = #{parentId}
  </select>
  
  <select id="findRecursionChildOrgInfos" resultMap="BaseResultMap" parameterType="java.lang.Integer"  >
    select 
    <include refid="Base_Column_List" />
    from sys_organization
    <where>
      <if test="id != null" >
         FIND_IN_SET(id, getRecursionChildOrgInfos(#{id,jdbcType=INTEGER}))
      </if>
    </where>
    and status = 0
  </select>
  
</mapper>