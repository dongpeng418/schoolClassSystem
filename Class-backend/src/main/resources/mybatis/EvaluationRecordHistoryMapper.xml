<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.com.school.classinfo.mapper.EvaluationRecordHistoryMapper">
    <resultMap id="BaseResultMap" type="cn.com.school.classinfo.model.EvaluationRecordHistory">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <result property="tenantId" column="tenant_id" jdbcType="INTEGER"/>
        <result property="companyId" column="company_id" jdbcType="INTEGER"/>
        <result property="organizationId" column="organization_id" jdbcType="INTEGER"/>
        <result property="evalId" column="eval_id" jdbcType="INTEGER"/>
        <result property="evalType" column="eval_type" jdbcType="INTEGER"/>
        <result property="evalCode" column="eval_code" jdbcType="VARCHAR"/>
        <result property="cityCode" column="city_code" jdbcType="VARCHAR"/>
        <result property="cityName" column="city_name" jdbcType="VARCHAR"/>
        <result property="distCode" column="dist_code" jdbcType="VARCHAR"/>
        <result property="distName" column="dist_name" jdbcType="VARCHAR"/>
        <result property="buildNo" column="build_no" jdbcType="VARCHAR"/>
        <result property="unit" column="unit" jdbcType="VARCHAR"/>
        <result property="roomNo" column="room_no" jdbcType="VARCHAR"/>
        <result property="propType" column="prop_type" jdbcType="VARCHAR"/>
        <result property="propTypeName" column="prop_type_name" jdbcType="VARCHAR"/>
        <result property="bldgArea" column="bldg_area" jdbcType="FLOAT"/>
        <result property="br" column="br" jdbcType="INTEGER"/>
        <result property="lr" column="lr" jdbcType="INTEGER"/>
        <result property="cr" column="cr" jdbcType="INTEGER"/>
        <result property="ba" column="ba" jdbcType="INTEGER"/>
        <result property="floor" column="floor" jdbcType="INTEGER"/>
        <result property="bheight" column="bheight" jdbcType="TIMESTAMP"/>
        <result property="faceCode" column="face_code" jdbcType="VARCHAR"/>
        <result property="faceName" column="face_name" jdbcType="VARCHAR"/>
        <result property="bldgTypeCode" column="bldg_type_code" jdbcType="VARCHAR"/>
        <result property="bldgTypeName" column="bldg_type_name" jdbcType="VARCHAR"/>
        <result property="buildYear" column="build_year" jdbcType="VARCHAR"/>
        <result property="intdecoCode" column="intdeco_code" jdbcType="VARCHAR"/>
        <result property="intdecoName" column="intdeco_name" jdbcType="VARCHAR"/>
        <result property="indoStruCode" column="indo_stru_code" jdbcType="VARCHAR"/>
        <result property="indoStruName" column="indo_stru_name" jdbcType="VARCHAR"/>
        <result property="proprtCode" column="proprt_code" jdbcType="VARCHAR"/>
        <result property="proprtName" column="proprt_name" jdbcType="VARCHAR"/>
        <result property="location" column="location" jdbcType="VARCHAR"/>
        <result property="haCode" column="ha_code" jdbcType="VARCHAR"/>
        <result property="haName" column="ha_name" jdbcType="VARCHAR"/>
        <result property="gpsLon" column="gps_lon" jdbcType="FLOAT"/>
        <result property="gpsLat" column="gps_lat" jdbcType="FLOAT"/>
        <result property="gpsType" column="gps_type" jdbcType="VARCHAR"/>
        <result property="unitPrice" column="unit_price" jdbcType="FLOAT"/>
        <result property="totalPrice" column="total_price" jdbcType="FLOAT"/>
        <result property="evalDate" column="eval_date" jdbcType="TIMESTAMP"/>
        <result property="samplePriceMax" column="sample_price_max" jdbcType="FLOAT"/>
        <result property="samplePriceMin" column="sample_price_min" jdbcType="FLOAT"/>
        <result property="samplePriceAvg" column="sample_price_avg" jdbcType="FLOAT"/>
        <result property="sampleCount" column="sample_count" jdbcType="INTEGER"/>
        <result property="inquiry" column="inquiry" jdbcType="INTEGER"/>
        <result property="advisory" column="advisory" jdbcType="INTEGER"/>
        <result property="principal" column="principal" jdbcType="VARCHAR"/>
        <result property="owner" column="owner" jdbcType="VARCHAR"/>
        <result property="cardAddress" column="card_address" jdbcType="VARCHAR"/>
        <result property="cardAddress" column="card_address" jdbcType="VARCHAR"/>
        <result property="businessTypeId" column="business_type_id" jdbcType="INTEGER"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="createBy" column="create_by" jdbcType="VARCHAR"/>
        <result property="createName" column="create_name" jdbcType="VARCHAR"/>
        <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
        <result property="updateBy" column="update_by" jdbcType="VARCHAR"/>
        <result property="updateName" column="update_name" jdbcType="VARCHAR"/>
    </resultMap>

    <sql id="Base_Column_List">
      id,tenant_id,organization_id,eval_id,eval_type,eval_code,city_code,city_name,dist_code,dist_name,build_no,unit,room_no,prop_type,
      prop_type_name,bldg_area,br,lr,cr,ba,floor,bheight,face_code,face_name,bldg_type_code,bldg_type_name,build_year,
      intdeco_code,intdeco_name,indo_stru_code,indo_stru_name,proprt_code,proprt_name,location,ha_code,ha_name,gps_lon,
      gps_lat,gps_type,unit_price,total_price,eval_date,inquiry,advisory,sample_price_max,
      sample_price_min,sample_price_avg,sample_count,principal,owner,card_address,business_type_id,
      create_time,create_by,create_name,update_time,update_by,update_name
    </sql>

    <sql id="Part_Column_List">
      id,tenant_id,organization_id,eval_id,eval_type,eval_code,city_code,city_name,dist_code,dist_name,build_no,unit,room_no,prop_type,
      prop_type_name,bldg_area,br,lr,cr,ba,floor,bheight,face_code,face_name,bldg_type_code,bldg_type_name,build_year,
      intdeco_code,intdeco_name,indo_stru_code,indo_stru_name,proprt_code,proprt_name,location,ha_code,ha_name,gps_lon,
      gps_lat,gps_type,unit_price,total_price,eval_date,inquiry,advisory,sample_price_max,
      sample_price_min,sample_price_avg,sample_count,principal,owner,card_address,business_type_id
    </sql>

    <insert id="insert" parameterType="cn.com.school.classinfo.model.EvaluationRecordHistory" useGeneratedKeys="true"
            keyProperty="id">
        insert into evaluation_record_history(
          tenant_id, company_id, organization_id, eval_id, eval_type, eval_code, city_code, city_name, dist_code, dist_name, build_no, unit,
          room_no, prop_type, prop_type_name, bldg_area, br, lr, cr, ba, floor, bheight,
          face_code, face_name, bldg_type_code, bldg_type_name, build_year, intdeco_code,
          intdeco_name, indo_stru_code, indo_stru_name, proprt_code, proprt_name, location,
          ha_code, ha_name, gps_lon, gps_lat, gps_type, unit_price, total_price, eval_date,inquiry,advisory,
          sample_price_max, sample_price_min, sample_price_avg, sample_count,
          principal, owner, card_address, business_type_id,
          create_time, create_by, create_name, update_time, update_by, update_name) 
        values(
          #{tenantId}, #{companyId},#{organizationId},#{evalId}, #{evalType}, #{evalCode}, #{cityCode}, #{cityName}, #{distCode}, #{distName},
          #{buildNo}, #{unit}, #{roomNo}, #{propType}, #{propTypeName}, #{bldgArea}, #{br}, #{lr}, #{cr},
          #{ba}, #{floor}, #{bheight}, #{faceCode}, #{faceName}, #{bldgTypeCode}, #{bldgTypeName},
          #{buildYear}, #{intdecoCode}, #{intdecoName}, #{indoStruCode}, #{indoStruName},
          #{proprtCode}, #{proprtName}, #{location}, #{haCode}, #{haName}, #{gpsLon}, #{gpsLat},
          #{gpsType}, #{unitPrice}, #{totalPrice}, #{evalDate}, #{inquiry},#{advisory},
          #{samplePriceMax}, #{samplePriceMin}, #{samplePriceAvg}, #{sampleCount},
          #{principal}, #{owner}, #{cardAddress}, #{businessTypeId},
          now(), #{createBy}, #{createName}, now(), #{updateBy}, #{updateName}
        )
    </insert>

    <update id="update" parameterType="cn.com.school.classinfo.model.EvaluationRecordHistory">
        update evaluation_record_history
          <trim prefix='set' suffixOverrides=','>
            <if test='inquiry != null'>
                inquiry = #{inquiry},
            </if>
            <if test='advisory != null'>
                advisory = #{advisory},
            </if>
            update_time = now(),
            update_by = #{updateBy},
            update_name = #{updateName}
          </trim>
        where id=#{id}
    </update>

    <select id="selectByQuery" resultMap="BaseResultMap" parameterType="cn.com.school.classinfo.common.query.EvalQuery">
        select
          <include refid="Part_Column_List"/>
        from evaluation_record_history
        where update_by = #{loginUser}
        <if test='evalHistoryId != null'>
            and id = #{evalHistoryId}
        </if>
        <if test='evalCode != null'>
            and eval_code = #{evalCode}
        </if>
    </select>

    <select id="selectListByQuery" resultMap="BaseResultMap" parameterType="cn.com.school.classinfo.common.query.EvalQuery">
        select
          <include refid="Part_Column_List"/>
        from evaluation_record_history 
        where eval_id = #{evalRecordId}
        and update_by = #{loginUser}
        and company_id = #{companyId}
    </select>

</mapper>